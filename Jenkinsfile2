pipeline {
    agent any
    parameters {
        text(name: 'ENTRADAS', defaultValue: '123=abc999\n789=qwe456', description: 'Llave=Valor por línea')
    }
    stages {
        stage('Actualizar CSV') {
            steps {
                script {
                    def csvPath = 'data.csv' // Ruta de tu archivo CSV
                    def csv = readFile(csvPath).trim().split('\n') as List
                    def encabezado = csv[0]
                    def registros = csv[1..-1].collect { it.split(';') }.collectEntries { [(it[0]): it[1]] }

                    // Procesar las líneas del parámetro
                    def entradas = params.ENTRADAS.trim().split('\n')
                    entradas.each { linea ->
                        def (partner, apikey) = linea.split('=')
                        partner = partner.trim()
                        apikey = apikey.trim()
                        registros[partner] = apikey  // actualiza o agrega
                    }

                    // Reconstruir el contenido del CSV
                    def nuevoCsv = ([encabezado] + registros.collect { k, v -> "${k};${v}" }).join('\n')

                    // Guardar cambios
                    writeFile file: csvPath, text: nuevoCsv
                    echo "Archivo actualizado:\n${nuevoCsv}"
                }
            }
        }
    }
}
